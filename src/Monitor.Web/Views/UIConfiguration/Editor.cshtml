@model dynamic

@{
	ViewBag.Title = "UI Configuration";
}

@section SubNavigation {
	<section class="contextMenu">
		<div class="actions">
			<label>Actions:</label>
			<button class="button btnSave" data-bind="click: SaveConfiguration" title="Save all changes"><i class="icon-save"></i><span class="text">Save</span></button>
			<button class="button btnAddGroup" data-bind="click: addGroup" title="Add a new group"><i class="icon-plus-sign"></i><span class="text">Add group</span></button>
		</div>
	</section>
}

<section class="content ui-configuration">

	<div class="agents">

		<header title="A list of all available agents">
			<h2>Agents</h2>
		</header>
		
		<!-- Agents -->
		<ul class="agent-dropzone" data-bind="foreach: KnownAgents, sortableListOfAgents: KnownAgents, parentList: KnownAgents">
			
			<!-- Agent -->
			<li data-bind="sortableItem: { item: $data, parentList: $parent.KnownAgents }, text: $data"></li>
		</ul>
		
		<!-- No agents indicator -->
		<div class="nogroups-indicator" data-bind="visible: KnownAgents().length === 0">
			There are currently no agents available.
		</div>

	</div>

	<div class="groups">

		<header title="A list of agent groups">
			<h2>Groups</h2>
		</header>
		
		<!-- Groups -->
		<ul data-bind="foreach: Groups, sortableListOfAgentGroups: Groups, parentList: Groups">
			
			<!-- Group -->
			<li data-bind="sortableItem: { item: $data, parentList: $parent.Groups }">
				
				<!-- Group name -->
				<header>
					<div class="view-mode" data-bind="visible: !$root.isTaskSelected($data)">
						<h3 data-bind="text: Name, click: $root.selectedTask">
						</h3>

						<div class="action-remove" title="Delete this group" data-bind="click: $root.removeGroup">
							<i class="icon-remove"></i>
						</div>
					</div>

					<div class="edit-mode" data-bind="visibleAndSelect: $root.isTaskSelected($data)">
						<input type="text" data-bind="value: Name, event: { blur: $root.clearTask }" />
					</div>
				</header>
				
				<!-- Agents assigned to this group -->
				<ul class="agent-dropzone" data-bind="foreach: Agents, sortableListOfAgents: Agents, parentList: Agents">
					
					<!-- Agent -->
					<li data-bind="sortableItem: { item: $data, parentList: $parent.Agents }, text: $data"></li>

				</ul>
			</li>
		</ul>
		
		<!-- No groups indicator -->
		<div class="nogroups-indicator" data-bind="visible: Groups().length === 0">
			No Groups
		</div>

	</div>

</section>

@section CustomScripts {
	<script type="text/javascript">
		var uiConfigurationOptions = {
			ApiUrl: '/api/groupconfiguration',
			SuccessCallback: function (message) {
				console.log(message);
			},
			ErrorCallback: function (message) {
				$(".ui-configuration:first").html("Cannot load ui configuration from \"{0}\".<br/>The service returned this message:<br/>{1}".format(this.ViewModelSaveUrl, message));
			},
			ModelReadyCallback: function () {
			}
		};
	</script>
	<script type="text/javascript" src="@Links.Scripts.Systemmonitor_UIConfiguration_js"></script>
}
